<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>响应式demo</title>
</head>
<body>
    <div id="app">
     
    </div> 
    <script>
      const obj = {foo: 'foo1', too: 'too1', woo: 3, ggg: {gname: 'wang'}}

      // 属性拦截
      function defineReactive(obj, key, val) {
        observe(val)

        Object.defineProperty(obj, key, {
          get: () => {
            console.log('get===:', key)
            return val
          },
          set: (newVal) => {
            if(newVal !== val){

              // 新值是对象的情况
              observe(newVal)
              val = newVal
              // update(newVal)
            }
          }
        })
      }

      // 遍历对象，对每个属性进行响应化处理
      function observe(obj){
        if(typeof obj !== 'object' || obj === null){
          return
        }

        Object.keys(obj).forEach((key) => {
          defineReactive(obj, key, obj[key])
        })
      }

      // 更新页面内容
      function update(value) {
        document.querySelector("#app").textContent = value
      }

      // 新加的属性没有拦截, 需要用set添加新属性
      function set(obj, key, val){
        defineReactive(obj, key, val)
      }

      observe(obj)
      console.log(obj.foo);
      obj.foo = 12222222222222222;
      console.log(obj.foo);
      console.log('=========================');
  
      obj.foo = {ww: '00102802'}
      console.log(obj.foo.ww)

      // obj.zyzy = 'zhangyz'
      set(obj, 'zyzy', 'zhangyyyzz')
      console.log('new pro',obj.zyzy)


      // obj.foo = new Date().toLocaleTimeString()

      // setInterval(() => {
      //   obj.foo = new Date().toLocaleTimeString()
      // }, 1000)
    </script>
</body>
</html>